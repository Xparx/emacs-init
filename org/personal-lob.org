#+title: My local library of babel

* How do I insert code block header :var in exported code block in org-mode
[[https://emacs.stackexchange.com/questions/27610/how-do-i-insert-code-block-header-var-in-exported-code-block-in-org-mode][source]]

#+NAME: expand-src-block
#+BEGIN_SRC elisp :var block-name="" datum="" info="" lang="" body="" :exports none :eval
(save-excursion
  (org-babel-goto-named-src-block block-name)
  (setq datum (org-element-at-point))
  t)
(setq info (org-babel-get-src-block-info nil datum))
(setq lang (nth 0 info))
(setq body (org-babel-expand-src-block nil info))
(format "%s" body)
#+END_SRC

To use this function on an existing code block as /e.g./
#+name: print-abc
#+BEGIN_SRC shell :var data="ABC" :exports none
echo -n $data
#+END_SRC

#+RESULTS: print-abc
: ABC

Create a block as follows
#+BEGIN_SRC shell :noweb yes :exports code
<<expand-src-block(block-name="print-abc")>>
#+END_SRC

#+name: py-print-abc
#+BEGIN_SRC python :var data="ABC" :exports none
print(data)
#+END_SRC


#+BEGIN_SRC python :noweb yes :exports code
<<expand-src-block(block-name="py-print-abc")>>
#+END_SRC


#+name: ipy-print-abc
#+BEGIN_SRC ipython :var data=my_bots :exports none
print(data)
#+END_SRC

#+BEGIN_SRC python :noweb yes :exports code
<<expand-src-block(block-name="ipy-print-abc")>>
#+END_SRC


* Python blocks

** Initiate ob-ipython session with defaut settings

#+name: initialize-ob-ipython-session
#+begin_src ipython :session :exports code :results silent
import sys
import os
from importlib import reload
sys.path.insert(0, './lib/')
sys.path.insert(0, './external/')
#+end_src

To use this as default when opening a buffer enter the following code in an local varaible block =M-x add-file-local-variable RET eval RET (org-sbe initialize-ob-ipython-session)=

#+name: load-ob-ipython-libraries
#+begin_src ipython :session :exports code :results silent
import pandas as pd
import numpy as np
import re
pd.set_option('precision',3)
#+end_src

** Plotting configurations in ipython

#+name: set-ob-ipython-default-plot-configs
#+begin_src ipython :session :exports code :results silent
%matplotlib tk
import seaborn as sns
import matplotlib as mpl
plt.style.use('seaborn-whitegrid')
mpl.rc('text', usetex=False)
mpl.rc('font', size='18')
# sns.set_palette('muted')
sns.set(style="whitegrid", palette="muted", color_codes=True, font_scale=2)
#+end_src

#+name: set-ob-ipython-default-plot-configs2
#+begin_src ipython :session :exports code :results silent
%matplotlib tk
import matplotlib as mpl
import matplotlib.pyplot as plt
import seaborn as sns

color_pallet = "muted"
plt.style.use('seaborn-whitegrid')
sns.set_context("notebook", font_scale=1.5)
sns.set_palette(color_pallet)
sns.set_color_codes(color_pallet)
#+end_src

#+name: example-plot
#+begin_src ipython :session :exports code :results silent
import numpy as np
fig, ax = plt.subplots(facecolor='w', edgecolor='k', figsize=(12,8), dpi=75)
__ = ax.plot(np.linspace(0, 2 * np.pi), np.sin(np.linspace(0, 2 * np.pi)), 'b-o')
__ = ax.grid(True)
__ = ax.set(xlabel="rad")
__ = ax.set(ylabel="Amplitude")
plt.tight_layout(pad=0)
#+end_src

#+name: save-figure-all-formats
#+begin_src ipython :session :exports code :results silent var: default_fname="/tmp/temporary_plot"
import pathlib
if 'fname' not in locals():
    fname = default_fname

if not os.path.exists(fname):
    os.makedirs(fname, exist_ok=True)

fig.savefig(os.path.join(fname, "pixel.png"), transparent=False)
fig.savefig(os.path.join(fname, "vector.svg"), transparent=False)
mpld3.save_html(fig,os.path.join(fname, "web.html"))

# print(fname, sep=",", end="")
#+end_src
